<%- include('../../partials/headers/__header-dashboard.ejs', { title: 'Detail Kunjungan' }) %>
<%- include('../../partials/navs/__nav-manajer.ejs') %>
<%- include('../../partials/messages/__messages-dashboard.ejs') %>

<%
    const formatDate = (value) => {
        if (!value) return '-'
        const date = new Date(value)
        if (isNaN(date)) return value
        return date.toLocaleDateString('id-ID', { 
            day: '2-digit', 
            month: 'long', 
            year: 'numeric'
        })
    }
%>

<style>
.detail-card {
    border: none;
    border-radius: 18px;
    box-shadow: 0 24px 60px rgba(15, 142, 200, 0.12);
    background: linear-gradient(145deg, #ffffff, #f6fbff);
}
.kunjungan-meta {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
}
.meta-item {
    background: rgba(15, 142, 200, 0.05);
    border-radius: 12px;
    padding: 0.85rem 1rem;
}
.meta-label {
    font-size: 0.82rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #0f172a;
    opacity: 0.75;
}
.meta-value {
    font-size: 1rem;
    font-weight: 600;
    color: #0f172a;
}
.description-box {
    background: #f8fafc;
    border-radius: 16px;
    padding: 1.25rem;
    border: 1px dashed rgba(15, 142, 200, 0.2);
}
.empty-state {
    border-radius: 18px;
    border: 1px dashed rgba(15, 142, 200, 0.25);
    padding: 1.75rem;
    text-align: center;
    color: #64748b;
}
@media (max-width: 575.98px) {
    .detail-card {
        border-radius: 14px;
    }
    .meta-item {
        padding: 0.75rem;
    }
}
</style>

<div class="main-panel">
    <div class="content-wrapper">
        <div class="row">
            <div class="col-lg-12 grid-margin">
                <div class="card detail-card">
                    <div class="card-body">
                        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
                            <div>
                                <h4 class="card-title mb-1">Detail Kunjungan</h4>
                                <p class="mb-0 text-muted"><%= kunjungan.judul %></p>
                            </div>
                            <div class="btn-actions mt-3 mt-md-0">
                                <a href="/manajer/kunjungan/edit/<%= kunjungan.id %>" class="btn btn-outline-info" data-loading>Edit</a>
                                <button type="button" class="btn btn-outline-danger btn-delete" data-url="/manajer/kunjungan/hapus/<%= kunjungan.id %>">Hapus</button>
                                <a href="/manajer/kunjungan" class="btn btn-light" data-loading>Kembali</a>
                            </div>
                        </div>

                        <div class="kunjungan-meta mb-3">
                            <div class="meta-item">
                                <div class="meta-label">Judul Kunjungan</div>
                                <div class="meta-value"><%= kunjungan.judul %></div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Waktu Kunjungan</div>
                                <div class="meta-value"><%= formatDate(kunjungan.waktu_kunjungan) %></div>
                            </div>
                        </div>

                        <div class="description-box mb-4">
                            <div class="d-flex align-items-center mb-2">
                                <span class="meta-label mb-0">Deskripsi</span>
                            </div>
                            <p class="mb-0 text-secondary" style="line-height:1.6;"><%= kunjungan.deskripsi %></p>
                        </div>

                        <hr class="my-4">

                        <h5 class="mb-3">Foto Kegiatan</h5>
                        <% if (Array.isArray(foto) && foto.length) { %>
                            <div class="image-preview-container">
                                <% foto.forEach(function(item){ %>
                                    <div class="image-preview-item">
                                        <img src="/images/kunjungan/<%= item.foto %>" data-src="/images/kunjungan/<%= item.foto %>" alt="foto kegiatan kunjungan" class="img-click-preview">
                                    </div>
                                <% }) %>
                            </div>
                        <% } else { %>
                            <div class="empty-state">
                                Belum ada foto kegiatan yang diunggah.
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade modal-below-navbar" id="modalConfirmDelete" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Konfirmasi Hapus</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Apakah Anda yakin ingin menghapus data ini?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-danger" id="btnConfirmDelete">Hapus</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade modal-below-navbar modal-top" id="globalImagePreviewModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Pratinjau Gambar</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0">
                <img id="globalImagePreviewEl" src="" alt="preview" style="width:100%;height:auto;display:block;">
            </div>
        </div>
    </div>
</div>

<%- include('../../partials/scripts/__script-dashboard.ejs') %>
